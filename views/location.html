<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="format-detection" content="telephone=no"/>

    <title>定位</title>
</head>
<body onload="getLocation()">

<div id="demo"></div>
<div id="baidu_geo">baidu</div>


<script>
    var x = document.getElementById("demo");
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition, showError);
        } else {
            alert("浏览器不支持地理定位。");
        }
    }
    function showPosition(position) {
        var lat = position.coords.latitude; //纬度
        var lag = position.coords.longitude; //经度
//        alert('纬度:' + lat + ',经度:' + lag);
        x.innerHTML = "Latitude: " + lat +
                "<br />Longitude: " + lag;

        var latlon = lat + ',' + lag;
        var y = document.getElementById("baidu_geo");

        //baidu
        var url = "http://api.map.baidu.com/geocoder/v2/?ak=sk4aD5OWDtIzYAgtOD8PdAmW&callback=renderReverse&location=" + latlon + "&output=json&pois=0";
        $.ajax({
            type: "GET",
            dataType: "jsonp",
            url: url,
            beforeSend: function () {
                y.innerHTML = '正在定位...';
                alert("正在定位");
            },
            success: function (json) {
                if (json.status == 0) {
                    y.innerHTML = json.result.formatted_address;
                    alert(json.result.formatted_address);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                y.innerHTML = latlon + "地址位置获取失败";
            }
        });
    }

    function showError(error) {
        switch (error.code) {
            case error.PERMISSION_DENIED:
                alert("定位失败,用户拒绝请求地理定位");
                break;
            case error.POSITION_UNAVAILABLE:
                alert("定位失败,位置信息是不可用");
                break;
            case error.TIMEOUT:
                alert("定位失败,请求获取用户位置超时");
                break;
            case error.UNKNOWN_ERROR:
                alert("定位失败,定位系统失效");
                break;
        }
    }
</script>
</body>
</html>